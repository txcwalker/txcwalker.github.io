{{ define "content" }}

  {{/* Collect pages in the projects section */}}
  {{ $pages := where .Pages "Type" "in" (slice "projects" "project") }}

  {{/* Use buttons from _index.md if provided; otherwise build from tags */}}
  {{ $buttons := .Params.buttons }}
  {{ if not $buttons }}
    {{ $tags := slice }}
    {{ range $pages }}
      {{ range .Params.tags }}
        {{ if not (in $tags .) }}{{ $tags = $tags | append . }}{{ end }}
      {{ end }}
    {{ end }}
    {{ $buttons = (slice "All") | append (sort $tags) }}
  {{ end }}

  <!-- Filter bar -->
  <div id="proj-filter" style="display:flex;gap:.5rem;flex-wrap:wrap;margin:0 0 1rem">
    {{ range $i, $b := $buttons }}
      <button class="pf-btn{{ if eq (lower $b) "all" }} pf-active{{ end }}"
              data-filter="{{ $b }}"
              style="padding:.45rem .9rem;border:1px solid #4ea1ff;border-radius:.66rem;background:#0b2239;color:#d3e7ff;cursor:pointer">
        {{ $b }}
      </button>
    {{ end }}
  </div>

  <!-- Card grid (self-contained; no theme partials) -->
  <div id="proj-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1rem">
    {{ range $pages }}
      {{ $pg := . }}
      {{ $t  := $pg.Params.tags | default (slice) }}

      {{/* pick a thumbnail if available */}}
      {{ $thumb := "" }}
      {{ with $pg.Params.thumbnail }}       {{ $thumb = . }} {{ end }}
      {{ if not $thumb }}{{ with $pg.Params.hero }}          {{ $thumb = . }} {{ end }}{{ end }}
      {{ if not $thumb }}{{ with $pg.Params.image }}         {{ $thumb = . }} {{ end }}{{ end }}
      {{ if not $thumb }}{{ with $pg.Resources.GetMatch "hero*" }}   {{ $thumb = .RelPermalink }} {{ end }}{{ end }}
      {{ if not $thumb }}{{ with $pg.Resources.GetMatch "cover*" }}  {{ $thumb = .RelPermalink }} {{ end }}{{ end }}
      {{ if not $thumb }}{{ with $pg.Resources.GetMatch "banner*" }} {{ $thumb = .RelPermalink }} {{ end }}{{ end }}

      <article class="project-card"
               data-tags="{{ delimit (apply $t "lower" ".") "|" }}"
               style="padding:1rem;border-radius:.75rem;background:#111a22;box-shadow:0 2px 10px rgba(0,0,0,.2)">

        {{ with $thumb }}
          <div style="margin:-1rem -1rem .75rem -1rem">
            <img src="{{ . | relURL }}" alt="{{ $pg.Title }}" style="width:100%;height:160px;object-fit:cover;border-top-left-radius:.75rem;border-top-right-radius:.75rem">
          </div>
        {{ end }}

        <h3 style="margin:.25rem 0 .5rem">
          <a href="{{ $pg.RelPermalink }}">{{ $pg.Title }}</a>
        </h3>

        {{ with $pg.Params.summary }}
          <p>{{ . }}</p>
        {{ else }}
          {{ with $pg.Summary }}<p>{{ . }}</p>{{ end }}
        {{ end }}

        {{ if $t }}
          <div class="pf-tags" style="display:flex;gap:.35rem;flex-wrap:wrap;margin-top:.5rem">
            {{ range $t }}<span class="pf-tag" style="font-size:.8rem;padding:.2rem .5rem;border-radius:999px;background:#0f2a40;color:#9acbff;border:1px solid #245a8f">{{ . }}</span>{{ end }}
          </div>
        {{ end }}
      </article>
    {{ end }}
  </div>

  <script>
  (function(){
    const bar   = document.getElementById('proj-filter');
    const grid  = document.getElementById('proj-grid');
    const cards = Array.from(grid.children);
    function tagsFor(card){
      const attr = card.getAttribute && card.getAttribute('data-tags');
      return attr ? attr.toLowerCase().split('|').filter(Boolean) : [];
    }
    bar.addEventListener('click', (e)=>{
      const btn = e.target.closest('button[data-filter]');
      if(!btn) return;
      bar.querySelectorAll('button').forEach(b=>b.classList.remove('pf-active'));
      btn.classList.add('pf-active');
      const want = btn.dataset.filter.toLowerCase();
      cards.forEach(card=>{
        const ts = tagsFor(card);
        card.style.display = (want === 'all' || ts.includes(want)) ? '' : 'none';
      });
    });
  })();
  </script>

  <style>
    .pf-btn.pf-active{ background:#1e90ff; color:#fff }
    #proj-grid .project-card{ margin-bottom: 0 } /* grid gap handles spacing */
  </style>

{{ end }}
